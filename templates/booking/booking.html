{% extends 'base.html' %} {% block main %}
<style>
  .img-container {
    width: 100%;
    max-width: 800px; /* Set a maximum width for better responsiveness */
    margin: 0 auto; /* Center the container horizontally */
  }

  .img-top {
    width: 100%;
    height: auto;
    object-fit: contain;
    aspect-ratio: 16/9;
  }

  h2,
  h4 {
    text-align: center;
  }
  h2 {
    font-weight: bold;
  }
  .form-group {
    margin: auto;
  }
  select option:disabled {
    background-color: gray;
    color: white; /* Optionally change text color */
  }
  select option:disabled {
    background-color: gray;
    color: white; /* Optionally change text color */
  }

  .img-container {
    width: 100%;
    max-width: 800px; /* Set a maximum width for better responsiveness */
    margin: 0 auto; /* Center the container horizontally */
    text-align: center; /* Center the content within the container */
  }
  .btn-addmin {
    width: 40px;
    height: 40px;
  }

  #book {
    width: 50px; /* Adjust the width as needed */
    height: 40px; /* Set the height equal to the width */
    text-align: end;
    font-size: 14px; /* Adjust the font size as needed */
    margin: 0 5px; /* Adjust the margin as needed */
  }
  .btn-secondary,
  .btn-primary {
    width: auto; /* Allow the button to adjust its width based on content */
    margin: 0 5px;
  }
</style>
<div class="img-container">
  <h2>{{space['name']}}</h2>
  <br />
  <img
    src="{{space['image']}}"
    class="card-img-top"
    alt="Foto {{space['name']}}"
  />
  <br /><br />
  <div class="form-group col-md-6">
    <h5>Booking Slot</h5>
    <div class="button-container" id="container1">
      <button class="btn btn-dark" id="todaydate">{{today_name}}</button>
    </div>
    <br />
    <div class="button-container" id="container2">Type: {{space['type']}}</div>

    {% if space['pay'] == 'flat' %}
    <br />
    <div class="button-container" id="container3">
      <button class="btn btn-danger btn-addmin" onclick="min()">-</button>
      <input type="number" name="book" id="book" value="1" min="1" max="" />
      <button class="btn btn-success btn-addmin" onclick="add()">+</button>
    </div>
    {% else %}
    <input
      type="number"
      name="book"
      id="book"
      value="1"
      min="1"
      max=""
      hidden
    />
    {% endif %}
  </div>
  <br />

  <div class="form-group col-md-5">
    <h5>Pilih Lantai:</h5>
    <select class="form-control" name="floor" id="floor-select">
      <option disabled selected>Pilih Lantai</option>
      {% for key, val in slot.items() %}
      <option value="{{key}}">Lantai {{key}}</option>
      {% endfor %}
    </select>

    {% for key, val in slot.items() %}
    <div class="card" id="card-{{ key }}" style="display: none">
      <div class="card-body">
        {% for x in val %}
        <button class="btn btn-outline-primary" onclick="toggleButton(this)">
          {{x}}
        </button>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>
  <br />
  <form action="/booking/{{space['name']}}" method="post">
    {% if space['pay'] == 'perjam' %}
    <div class="form-group col-md-5">
      <div>
        <label for="fromPicker" class="form-label">From:</label>
        <select id="fromPicker" name="fromPicker" class="form-control"></select>
      </div>
      <div>
        <label for="toPicker" class="form-label">To:</label>
        <select id="toPicker" name="toPicker" class="form-control"></select>
      </div>
    </div>
    {% endif %}
    <input
      id="mynum"
      name="mynum"
      type="number"
      value=""
      style="display: none"
    />
    <input id="mine" name="mine" type="text" value="" style="display: none" />
    <div class="form-group col-md-6">
      <input type="text" name="slots" id="slots" value="" hidden />
      <input type="text" name="books" id="books" value="" hidden />
      <br />
      <div class="d-flex justify-content-center">
        <button class="btn btn-success" type="submit">Lanjut Bayar</button>
      </div>
    </div>
  </form>
</div>

<script>
  var selectedButtons = [];
  document.getElementById("books").value = 1;

  function toggleButton(button) {
    if (selectedButtons.includes(button)) {
      button.classList.remove("btn-primary");
      button.classList.add("btn-outline-primary");
      var index = selectedButtons.indexOf(button);
      if (index > -1) {
        selectedButtons.splice(index, 1);
      }
      // Remove the slot value from the selected slots
      var btnval = button.innerHTML;
      var slotval = document.getElementById("slots").value;
      var newValue = slotval
        .split(",")
        .filter((slot) => slot.trim() !== btnval.trim())
        .join(",");
      document.getElementById("slots").value = newValue;
    } else {
      var waklo = document.getElementById("book").value;
      if (selectedButtons.length < waklo) {
        button.classList.remove("btn-outline-primary");
        button.classList.add("btn-primary");
        selectedButtons.push(button);
        var btnval = button.innerHTML;
        var slotval = document.getElementById("slots");
        var currentVal = slotval.value;
        var newValue = currentVal ? currentVal + "," + btnval : btnval;
        document.getElementById("slots").value = newValue;
      } else {
        alert("You can only select " + waklo + " buttons.");
      }
    }
  }

  document
    .getElementById("floor-select")
    .addEventListener("change", function () {
      var selectedValue = this.value;
      var allCards = document.querySelectorAll(".card");
      allCards.forEach(function (card) {
        card.style.display = "none";
      });
      var selectedCard = document.getElementById("card-" + selectedValue);
      if (selectedCard) {
        selectedCard.style.display = "block";
        resetButtons();
      }
    });

  function resetButtons() {
    selectedButtons.forEach(function (button) {
      button.classList.remove("btn-primary");
      button.classList.add("btn-outline-primary");
    });
    selectedButtons = [];
  }

  var options = {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  };
  var dayOfWeek = new Date().toLocaleDateString("id-ID", options);

  document.getElementById("todaydate").textContent = dayOfWeek;

  function add() {
    var input = document.getElementById("book");
    input.value = parseInt(input.value, 10) + 1;
    document.getElementById("books").value = input.value;
  }
  function min() {
    var input = document.getElementById("book");
    if (input.value > 1) {
      input.value = parseInt(input.value, 10) - 1;
      document.getElementById("books").value = input.value;
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    var fromPicker = document.getElementById("fromPicker");
    var toPicker = document.getElementById("toPicker");
    var timeRange = "{{space['hours']}}"; // Your time range string

    // Extracting start and end hours from the time range string
    var startHour = parseInt(timeRange.split(" - ")[0].split(":")[0]);
    var endHour = parseInt(timeRange.split(" - ")[1].split(":")[0]);

    var now = new Date();
    var currentHour = now.getHours();

    // Adding options for "From" time
    for (var i = startHour; i <= endHour; i++) {
      var option = document.createElement("option");
      option.text = i < 10 ? "0" + i + ":00" : i + ":00"; // Adding leading zero for single digit hours
      option.value = i;
      if (i < currentHour) {
        option.disabled = true;
      }
      fromPicker.add(option);
    }

    // Adding options for "To" time
    for (var j = startHour; j <= endHour; j++) {
      var option = document.createElement("option");
      option.text = j < 10 ? "0" + j + ":00" : j + ":00"; // Adding leading zero for single digit hours
      option.value = j;
      if (j <= currentHour) {
        option.disabled = true;
      }
      toPicker.add(option);
    }
  });
</script>
{% endblock main %}
